<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Post Violations Management</title>
<link rel="stylesheet" href="/css/styles.min.css" />
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&display=swap">
<script src="https://kit.fontawesome.com/f737751420.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script
	src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
	integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
	crossorigin="anonymous"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
	integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
	crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<style>
body {
	font-family: 'Plus Jakarta Sans', sans-serif;
}

input.hover-effect:hover {
	border-color: #1261c2;
	/* Màu viền thay đổi khi hover */
	box-shadow: 0 0 5px #1d4bcc;
	/* Hiển thị đổ bóng khi hover */
	cursor: pointer;
}

.circle {
	width: 7px;
	height: 7px;
	background-color: rgb(225, 15, 15);
	border-radius: 50%;
}

.image-link {
	display: flex;
	align-items: center;
	text-decoration: none;
	color: #989692;
	margin-left: 30px;
}

.content {
	display: flex;
	flex-direction: column;
	margin-left: 10px;
}

.sidebar-scrollable {
	max-height: 540px;
	/* Đặt chiều cao tối đa của vùng cuộn */
	overflow-y: auto;
	/* Tạo thanh cuộn dọc */
}

.sidebar-scrollable::-webkit-scrollbar {
	width: 4px;
	/* Độ rộng của thanh cuộn */
}

.sidebar-scrollable::-webkit-scrollbar-thumb {
	background-color: #888;
	/* Màu sắc của thanh cuộn */
	border-radius: 4px;
	/* Bo tròn viền thanh cuộn */
}

.sidebar-scrollable::-webkit-scrollbar-track {
	background-color: #f5f5f5;
	/* Màu sắc của vùng di chuyển thanh cuộn */
}
</style>

<body ng-app="VtmApp" ng-controller="VtmCtrl">
	<!--  Body Wrapper -->
	<div class="page-wrapper" id="main-wrapper" data-layout="vertical"
		data-navbarbg="skin6" data-sidebartype="full"
		data-sidebar-position="fixed" data-header-position="fixed">
		<!-- Sidebar Start -->
		<aside class="left-sidebar">
			<!-- Sidebar scroll-->
			<div>
				<div
					class="brand-logo d-flex align-items-center justify-content-between">
					<a href="/admin/postsviolation" class="text-nowrap logo-img"
						style="color: #222; font-weight: bolder; font-family: 'robo';">
						<img src="/images/chimLac.png" height="30px" alt="">
						VIE_SONET
					</a>
				</div>
				<!-- Sidebar navigation-->
				<nav class="sidebar-nav scroll-sidebar" data-simplebar="">
					<ul id="sidebarnav">
						<li class="nav-small-cap"><i
							class="ti ti-dots nav-small-cap-icon fs-4"></i> <span
							class="hide-menu">Quản Lý</span></li>
						<li class="sidebar-item"><a class="sidebar-link active"
							href="/admin/usermanager" aria-expanded="false"> <span>
									<i class="fa-solid fa-list"></i>
							</span> <span class="hide-menu">Điều khoản</span>
						</a> <a class="sidebar-link " href="/admin/postsviolation"
							aria-expanded="false"> <span> <i
									class="fa-regular fa-memo-circle-info"></i>
							</span> <span class="hide-menu"> &nbsp; Tố cáo bài viết</span>
						</a></li>
					</ul>

				</nav>
				<!-- End Sidebar navigation -->
			</div>
			<!-- End Sidebar scroll-->
		</aside>
		<!--  Sidebar End -->
		<!--  Main wrapper -->
		<div class="body-wrapper">
			<!--  Header Start -->
			<header class="app-header"
				style="border-bottom: 1px solid rgb(229, 234, 239);">
				<nav class="navbar navbar-expand-lg navbar-light">
					<div class="navbar-collapse justify-content-end px-0"
						id="navbarNav">
						<ul
							class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
							<li class="nav-item dropdown"><a
								class="nav-link nav-icon-hover" href="#" id="drop2"
								data-bs-toggle="dropdown" aria-expanded="false"> <i
									class="fa-regular fa-bell"></i>
									<div class="circle mb-2"></div>
							</a>
								<div style="background: whitesmoke;"
									class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up"
									aria-labelledby="drop2">
									<div class="message-body">
										<a href="#"
											class="d-flex align-items-center gap-2 dropdown-item"> <i
											class="ti ti-user fs-6"></i>
											<p class="mb-0 fs-3">Thông báo 1</p>
										</a> <a href="#"
											class="d-flex align-items-center gap-2 dropdown-item"> <i
											class="ti ti-user fs-6"></i>
											<p class="mb-0 fs-3">Thông báo 2</p>
										</a> <a href="#"
											class="d-flex align-items-center gap-2 dropdown-item"> <i
											class="ti ti-user fs-6"></i>
											<p class="mb-0 fs-3">Thông báo 3</p>
										</a>
									</div>
								</div></li>
							<li class="nav-item dropdown"><a
								class="nav-link nav-icon-hover" href="#" id="drop2"
								data-bs-toggle="dropdown" aria-expanded="false"> <img
									src="/images/user-1.jpg" alt="" width="35" height="35"
									class="rounded-circle">
							</a>
								<div style="background: whitesmoke;"
									class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up"
									aria-labelledby="drop2">
									<div class="message-body">
										<div class="py-3 px-7 pb-0">
											<h5 class="mb-0 fs-5 fw-semibold">Cá nhân</h5>
										</div>
										<a href="#"
											class="d-flex align-items-center gap-2 dropdown-item">
											<div
												class="d-flex align-items-center py-9 mx-7 border-bottom">
												<img src="/images/user-1.jpg" class="rounded-circle"
													width="80" height="80" alt="">
												<div class="ms-3">
													<h5 class="mb-1 fs-3">Mathew Anderson</h5>
													<span class="mb-1 d-block text-dark">Designer</span>
													<p class="mb-0 d-flex text-dark align-items-center gap-2">
														<i class="ti ti-mail fs-4"></i> info@modernize.com
													</p>
												</div>
											</div>
										</a> <a href="#"
											class="d-flex align-items-center gap-2 dropdown-item"> <i
											class="ti ti-user fs-6"></i>
											<p class="mb-0 fs-3">Đổi mật khẩu</p>
										</a> <a href="#"
											class="d-flex align-items-center gap-2 dropdown-item"> <i
											class="ti ti-mail fs-6"></i>
											<p class="mb-0 fs-3">Thông tin điều khoản</p>
										</a> <a href="#"
											class="d-flex align-items-center gap-2 dropdown-item"> <i
											class="ti ti-list-check fs-6"></i>
											<p class="mb-0 fs-3">Nâng cấp</p>
										</a> <a href="#" class="btn btn-outline-primary mx-3 mt-2 d-block">Đăng
											xuất</a>
									</div>
								</div></li>
						</ul>
					</div>
				</nav>
			</header>
			<!--  Header End -->
			<div class="container-fluid">
				<!--  Row 1 -->
				<div class="row">
					<div class="card-title fw-semibold mb-2">
						<nav class="navbar navbar-expand-lg navbar-light">
							<ul class="navbar-nav">
								<a href="#" class="me-5"
									data-bs-placement="top" title="Thêm loại vi phạm"
									ng-click="addViolationModal()"> <i
									class="fa-solid fa-plus fa-lg"></i> &nbsp Thêm
								</a>
							</ul>
							<div class="navbar-collapse justify-content-end px-0">
								<ul
									class="navbar-nav flex-row ms-auto align-items-center justify-content-end">

									<form class="position-relative">
										<input type="text" class="form-control search-chat py-2 ps-5"
											id="text-srh" placeholder="Nhập chi tiết vi phạm"
											ng-keyup="searchByDescription()" ng-model="searchText"
											style="border: 1px solid #ccc;"> <i
											class="fa-solid fa-magnifying-glass fa-2xs position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
									</form>
								</ul>
							</div>

						</nav>
					</div>
					<div class="table-responsive sidebar-scrollable">
						<table class="table text-nowrap mb-0 align-middle">
							<thead class="text-dark fs-4">
								<tr>
									<th class="border-bottom-0">
										<h6 class="fw-semibold mb-0">Mã vi phạm</h6>
									</th>
									<th class="border-bottom-0">
										<h6 class="fw-semibold mb-0">Nội dung vi phạm</h6>
									</th>
									<th class="border-bottom-0">
										<h6 class="fw-semibold mb-0 text-center">Cập nhật</h6>
									</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="list in listViolationType" id="row">
									<td class="border-bottom-0"><span class="fw-normal mb-0"
										style="max-width: 250px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
											{{list.violationTypeId}} </span></td>
									<td class="border-bottom-0"
										style="max-width: 200px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
										<span class="fw-normal">{{list.violationDescription}}</span>
									</td>
									<td class="border-bottom-0 text-center"><a href="#"
										data-bs-placement="top" title="Xem chi tiết bài viết"
										ng-click="detailViolation(list.violationTypeId)"> <i
											class="fa-solid fa-pen"></i>
									</a></td>
								</tr>
							</tbody>
						</table>

					</div>
				</div>
			</div>
			<!-- Modal -->
			<div class="modal fade" id="exampleModal" tabindex="-1"
				aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div
					class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title">Cập nhật</h4>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<form>
								<center>
									<div style="color: red;" ng-bind="errorMessage">{{
										errorMessage }}</div>
								</center>

								<!-- Input field for "Mô tả vi phạm" -->
								<div class="mb-3">
									<label for="violationDescription" class="form-label">Mô
										tả vi phạm</label> <input type="text" class="form-control"
										id="violationDescription" ng-model="violationDescription"
										placeholder="{{listViolation.violationDescription}}">
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<!-- Cancel button -->
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">Hủy</button>
							<!-- Edit button -->
							<button type="button"
								ng-click="submitForm(listViolation.violationTypeId)"
								class="btn btn-primary">Sửa</button>
						</div>
					</div>
				</div>
			</div>


			<!-- Modal -->
			<div class="modal fade" id="addViolationModal" tabindex="-1"
				aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div
					class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title">Thêm vi phạm</h4>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<form>
								<center>
									<div style="color: red;" ng-bind="errorMessage">{{
										errorMessage }}</div>
								</center>
											
								<!-- Input field for "Mô tả vi phạm" -->
								<div class="mb-3">
									<label for="violationDescription" class="form-label">Mô
										tả vi phạm</label> <input type="text" class="form-control"
										id="violationDescription" ng-model="violationDescription">
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<!-- Cancel button -->
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">Hủy</button>
							<!-- Add button -->
							<button type="button" ng-click="addViolation()"
								class="btn btn-primary">Thêm</button>
						</div>
					</div>
				</div>
			</div>





			<script src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
			<script
				src="https://cdn.jsdelivr.net/npm/simplebar@5.3.0/dist/simplebar.min.js"></script>
</body>
<script>
	var app = angular.module('VtmApp', []);
	var originalList = [];	
	
	 
	app.controller('VtmCtrl', function ($scope, $http) {
		$scope.listViolationType = [];
		$scope.listViolation = [];
		$scope.violation = {};
		

		$http.get('/staff/violationtype/load').then(function (response) {
			// Gán dữ liệu từ API vào biến $scope.listViolations
			originalList = response.data;
			$scope.listViolationType = response.data;
		}).catch(function (error) {
			console.error('Lỗi khi lấy dữ liệu bài viết vi phạm:', error);
		});

		//Hàm tải dữ liệu ban đầu
		function loadInitialData() {
			$http.get('/staff/violationtype/load')
				.then(function (response) {
					// Lưu trữ danh sách gốc vào biến originalList
					originalList = response.data;
					// Gán danh sách cho biến $scope.listViolations để hiển thị
					$scope.listViolationType = response.data;
				})
				.catch(function (error) {
					console.error('Lỗi khi tải dữ liệu:', error);
				});
		}

		$scope.searchByDescription = function () {
	        var description = $scope.searchText;
	        
	        if (!description) {
	            // Nếu ô tìm kiếm rỗng, gán lại bản sao của danh sách gốc cho $scope.listViolationType
	            $scope.listViolationType = angular.copy(originalList);
	            return;
	        }
	        $http.get('/staff/violationtype/searchViolationDescription', { params: { description: description } })
	            .then(function (response) {
	                // Xử lý kết quả tìm kiếm ở đây
	                $scope.listViolationType = response.data;
	            })
	            .catch(function (error) {
	                console.error('Lỗi khi tìm kiếm bài viết:', error);
	            });
	    };

		$scope.addViolationModal = function() {
	        // Show the modal
	        $('#addViolationModal').modal('show');
	    };

	    $scope.addViolation = function() {	        
	        var violationDescription = $scope.violationDescription;

	        var data = {	           
	            violationDescription: violationDescription
	        };

	        $http({
	            method: 'POST',
	            url: '/staff/violationtype/addViolationDescription',
	            data: data,
	            headers: { 'Content-Type': 'application/json' }
	        })
	        .then(function(response) {
	            // Handle success response here
	            // For example, show a success message
	            Swal.fire({
	                title: 'Thành công!',
	                text: 'Thêm vi phạm thành công!',
	                icon: 'success',
	                showCancelButton: false,
	                confirmButtonText: 'OK'
	            }).then(function(result) {
	                if (result.isConfirmed) {
	                    // Reload the page to update the table
	                    window.location.reload();
	                }
	            });
	        })
	        .catch(function(error) {
	            // Handle error response here
	            // For example, show an error message
	            Swal.fire({
	                title: 'Lỗi!',
	                text: 'Đã xảy ra lỗi khi thêm vi phạm!',
	                icon: 'error',
	                showCancelButton: false,
	                confirmButtonText: 'OK'
	            });
	        });
	    };

	
	 
		// Hàm xem chi tiết bài viết
		$scope.detailViolation = function (violationTypeId) {
			// Gọi API để lấy thông tin chi tiết bài viết dựa vào postId
			$http.get('/staff/violationtype/detailViolation/' + violationTypeId)
				.then(function (response) {
					$scope.violation = response.data;
					console.log($scope.violation);
					$('#exampleModal').modal('show'); // Hiển thị modal khi có dữ liệu bài viết
				})
				.catch(function (error) {
					console.error('Lỗi khi lấy thông tin chi tiết bài viết:', error);
				});
			$http.get('/staff/violationtype/detailViolation/' + violationTypeId)
				.then(function (response) {
					$scope.listViolation = response.data;
				})
				.catch(function (error) {
					console.error('Lỗi khi lấy thông tin chi tiết vi phạm:', error);
				});
		};

		

		$scope.submitForm = function(violationTypeId) {
		    var violationDescription = $scope.violationDescription;

		    var data = {
		        violationDescription: violationDescription
		    };

		    $http({
		        method: 'POST',
		        url: '/staff/violationtype/updateViolationDescription/' + violationTypeId,
		        data: JSON.stringify(data), // Chuyển đổi data thành chuỗi JSON
		        headers: { 'Content-Type': 'application/json' }
		    })
		    .then(function(response) {
		        var result = response.data;
		        if (result.message) {
		            $scope.errorMessage = result.message;
		        } else {
		            Swal.fire({
		                title: 'Thành công!',
		                text: 'Cập nhật thành công!',
		                icon: 'success',
		                showCancelButton: false,
		                confirmButtonText: 'OK'
		            }).then((result) => {
		                // Check if the user clicked the "OK" button
		                if (result.isConfirmed) {
		                    // Reload the page to update the table
		                    window.location.reload();
		                }
		            });
		        }
		    })
		    .catch(function(error) {
		        console.log(error);
		    });
		};


	});
</script>

</html>