<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/f737751420.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="/css/style.css">
    <title>Đăng ký</title>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #888;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .ip[type=text],
        .ip[type=password],
        .ip[type=email] {
            width: 100%;
            padding: 8px 20px;
            margin: 8px 0;
            border: none;
            border-bottom: 1px solid #ccc;
            box-sizing: border-box;
            background: transparent;
            border-radius: 0;
            transition: 0.5s;
            padding-left: 0;
        }

        .ip:focus {
            border-bottom: 1px solid #3B998B;
            box-shadow: none;
        }

        .lgin {
            background-color: #F27323;
            color: white;
            padding: 2px;
            border: none;
            cursor: pointer;
            width: 40%;
            transition: 0.3s;
            border-radius: 3px;
        }

        .lgin:hover {
            background: #A59565;
        }

        .cancelbtn {
            width: auto;
            padding: 7px 18px;
            background-color: #A59565;
            border: none;
            color: white;
            transform: skewX(-20deg);
        }

        span.psw {
            float: right;
        }

        /* Change styles for span and cancel button on extra small screens */
        @media screen and (max-width: 300px) {
            span.psw {
                display: block;
                float: none;
            }

            .cancelbtn {
                width: 100%;
            }
        }
    </style>
</head>

<body ng-app="registerApp" ng-controller="registerCtrl">
    <header class="header animationTop3" style="background: transparent;">
        <nav class="navbar navbar-expand-sm navbar-light" style="border: none; padding-top: 0; padding-bottom: 0;">
            <div class="container">
                <a class=" logo"> <img src="images/chimLac.png" height="30px" alt=""> VIE_<b>SONET</b>
                </a>
                <button class="navbar-toggler d-lg-none" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapsibleNavId" aria-controls="collapsibleNavId" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="collapsibleNavId">
                    <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                        <li class="nav-item"><a class="nav-link" href="/dangky">
                                <p style="color: #5d5d5d;">Đăng Nhập</p>
                            </a></li>
                    </ul>
                </div>

            </div>
        </nav>
    </header>
    <div>
        <div style="position: absolute; width: 40%; top: 50%; transform: translate(0, -50%); left: 5%; z-index: -10;">
            <img class="animate__animated animate__rotateInDownLeft" src="images/dangKy.png" style="width: 100%;"
                alt="">
        </div>
        <div class="row">
            <div class="col-md-4 offset-md-6 animate__animated animate__backInRight"
                style="padding: 15px; padding-left: 40px; padding-right: 40px; background-color: white;">
                <form ng-submit="submitForm()" style="text-align: left; width: 100%;">
                    <div class="row">
                        <center>
                            <h4 class="nhan" style="color: #5d5d5d;">
                                <b>ĐĂNG KÝ</b>
                            </h4>
                            <div ng-bind="errorMessage" style="color: red;"></div>
                        </center>

                        <div class="mb-3">
                            <input type="text" class="form-control ip" ng-model="username" aria-describedby="helpId"
                                placeholder="Họ tên" required>
                        </div>
                        <div class="mb-3">
                            <input type="text" class="form-control ip" ng-model="phoneNumber" aria-describedby="helpId"
                                placeholder="Số điện thoại" pattern="[0-9]{10}" required>
                        </div>
                        <div class="mb-3">
                            <input type="email" class="form-control ip" ng-model="email" aria-describedby="helpId"
                                placeholder="Email" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control ip" ng-model="password" aria-describedby="helpId"
                                placeholder="Mật khẩu" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control ip" ng-model="confirmPassword"
                                aria-describedby="helpId" placeholder="Mật khẩu xác nhận" required>
                        </div>
                        <div class="mb-3">
                            <label>Giới tính</label> <br>
                            <label> <input type="radio" ng-model="gender" value="true"> Nam
                            </label> &nbsp &nbsp &nbsp &nbsp
                            <label> <input type="radio" value="false" ng-model="gender"> Nữ
                            </label>
                        </div>
                        <div class="row">
                            <div class="col-md-7">
                                <input class="form-control ip" type="text" placeholder="Nhập mã đã gửi?"
                                    ng-model="code">


                            </div>

                            <div class="col-md-5">
                                <br>
                                <button class="lgin" ng-click="guiMa($event)">Gửi mã</button>
                            </div>
                        </div>

                        <label> <input type="checkbox" ng-model="accept" value="true">
                            <small>&nbspChấp nhận <a style="Color: #007ACC" href="#"
                                    onclick="angular.element(this).scope().openModal()">
                                    điều khoản</a></small>
                        </label>
                    </div>
                    <br>
                    <center>
                        <button type="submit" class="btn-blue" style="background-color: #007ACC; width: 100%;">Đăng
                            Ký</button>

                    </center>

                </form>
            </div>
        </div>

    </div>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="angular.element(this).scope().closeModal()">&times;</span>
            <center>
                <h4>ĐIỀU KHOẢN - VIE_SONET</h4>
            </center>
            <p>- Bạn sẽ phải cung cấp một số thông tin cá nhân để xác thực và bạn yên tâm chúng tôi sẽ không dùng chúng
                trong những việc xấu</p>
            <p>- Không được phép sử dụng trang mạng xã hội cho những lợi ích cá nhân như lừa đảo chiếm đoạt tài sản, nếu
                có
                chúng tôi sẽ sử phạt rất nặng về vấn đề này.</p>
            <p>- Nghiêm cấm những hành vi xúc phạm, lăng mạ hay dùng từ công kích, kỳ thị đến sắc tốc, màu da.</p>
            <p>- Những hành vi đăng bài viết mang tính chất khiêu dâm, đồi trụy sẽ bị chúng tôi xóa bỏ và có thể khóa
                tài khoản
                nếu vi phạm</p>
            <p>- Đặc biệt với những hành vi đăng bài chống phá đảng và nhà nước, chia rẽ tinh thần đoàn kết dân tộc sẽ
                bị bài trừ</p>
        </div>
    </div>

</body>
<script>
    var app = angular.module('registerApp', []);

    app.controller('registerCtrl', function ($scope, $http) {
        $scope.gender = 'true';
		
        $scope.guiMa = function(event) {
            var email = $scope.email;
            var username = $scope.username;
            var data = {
            	email: email,
            	username: username
            };
            
            $http({
                method: 'POST',
                url: '/dangky/guima',
                data: data,
                headers: { 'Content-Type': 'application/json' }
            })
                .then(function(response) {
                    var result = response.data;
                    if (result.message) {
                        $scope.errorMessage = result.message;                 
                    } else {
                    	$scope.errorMessage = '',
                    	Swal.fire(
                    			  'Đã gửi!',
                    			  'Mật mã đã gửi đến bạn!',
                    			  'success'
                    			)
                    }
                })
                .catch(function(error) {
                    console.log(error);
                });
            
            event.preventDefault();
        };
        

        $scope.submitForm = function () {
            // Lấy giá trị từ các trường nhập liệu
            var phoneNumber = $scope.phoneNumber;
            var password = $scope.password;
            var confirmPassword = $scope.confirmPassword;
            var username = $scope.username;
            var email = $scope.email;
            var gender = $scope.gender;
            var accept = $scope.accept;
            var code = $scope.code;

            // Tạo đối tượng dữ liệu để gửi đi
            var data = {
                phoneNumber: phoneNumber,
                password: password,
                confirmPassword: confirmPassword,
                username: username,
                email: email,
                gender: gender,
                accept: accept,
                code: code
            };

            // Gửi yêu cầu HTTP đến URL /dangky với phương thức POST
            $http.post('/dangky', data).then(function (response) {
                // Xử lý phản hồi từ máy chủ tại đây
                if (response.data.message) {
                    // Hiển thị thông báo lỗi cho người dùng
                    $scope.errorMessage = response.data.message;
                } else {
                    Swal.fire({
                        title: 'Thành công!',
                        text: 'Đăng ký tài khoản!',
                        icon: 'success',
                        showCancelButton: false,
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        // Check if the user clicked the "OK" button
                        if (result.isConfirmed) {
                            // Redirect to another page
                            window.location.href = '/login'; // Replace '/another-page' with the desired URL
                        }
                    });
                }
            });
        };

        $scope.openModal = function () {
            var modal = document.getElementById("myModal");
            modal.style.display = "block";
        };

        $scope.closeModal = function () {
            var modal = document.getElementById("myModal");
            modal.style.display = "none";
        };
    });
</script>

</html>