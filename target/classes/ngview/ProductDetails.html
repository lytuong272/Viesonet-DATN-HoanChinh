<div>
    <!-- content -->
    <section style="padding-top: 0 !important">
        <div>
            <div class="row gx-5">
                <aside class="col-lg-6">
                    <section>
                        <div class="container" style="padding: 0;">
                            <div class="carousel">
                                <input ng-repeat="media in product.media" type="radio" name="slides" checked="checked"
                                    id="slide-{{media.mediaId}}">
                                <ul class="carousel__slides" style="max-height: 50vh;">
                                    <li class="carousel__slide" ng-repeat="media in product.media">
                                        <figure>
                                            <div style="height: 50vh;display: flex;
                                            align-items: center;
                                            justify-content: center;">
                                                <img ng-src="{{media.mediaUrl}}" alt=""
                                                    style="height: 50vh; border: 1px solid #dee2e6; border-radius: 3px;">
                                            </div>
                                        </figure>
                                    </li>
                                </ul>
                                <ul class="carousel__thumbnails" style="justify-content: center;">
                                    <li style="margin-right: 2px;" ng-repeat="media in product.media">
                                        <label for="slide-{{media.mediaId}}"><img ng-src="{{media.mediaUrl}}"
                                                style="max-height: 20vh;" alt=""></label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </section>
                </aside>
                <main class="col-lg-6">
                    <div class="ps-lg-3">
                        <div style="display: flex; justify-content: space-between;">
                            <h4 class="title text-dark">
                                {{product.productName}}
                            </h4>
                            <button data-bs-toggle="modal" data-bs-target="#modalId"
                                style="border: none; background-color: transparent;"><i
                                    class="fa-regular fa-flag"></i></button>


                            <!-- Modal -->
                            <div class="modal fade" id="modalId" tabindex="-1" role="dialog"
                                aria-labelledby="modalTitleId" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="modalTitleId">Tố cáo sản phẩm</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="mb-3">
                                                <label for="" class="form-label">Nhập nội dung tố cáo sản phẩm:</label>
                                                <input ng-model="reportContent" type="text" class="form-control" name=""
                                                    id="" aria-describedby="helpId" placeholder="">
                                                <small id="helpId" class="form-text text-muted">Help text</small>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">Hủy</button>
                                            <button ng-click="reportProduct()" type="button" class="btn btn-primary">Tố
                                                cáo</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <script>
                                var modalId = document.getElementById('modalId');

                                modalId.addEventListener('show.bs.modal', function (event) {
                                    // Button that triggered the modal
                                    let button = event.relatedTarget;
                                    // Extract info from data-bs-* attributes
                                    let recipient = button.getAttribute('data-bs-whatever');

                                    // Use above variables to manipulate the DOM
                                });
                            </script>

                        </div>
                        <div class="d-flex flex-row my-3">
                            <div class="text-warning mb-1 me-2">

                                <span>
                                    <span ng-if="AverageRating==0">
                                        <i ng-repeat="n in [].constructor(5) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>
                                    <span ng-if="AverageRating==1">
                                        <i ng-repeat="n in [].constructor(4) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(1) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>

                                    </span>
                                    <span ng-if="AverageRating==2">
                                        <i ng-repeat="n in [].constructor(2) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(3) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>
                                    <span ng-if="AverageRating==3">
                                        <i ng-repeat="n in [].constructor(3) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(2) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>
                                    <span ng-if="AverageRating==4">
                                        <i ng-repeat="n in [].constructor(4) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(1) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>
                                    <span ng-if="AverageRating==5">
                                        <i ng-repeat="n in [].constructor(5) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                    </span>

                                    <!-- --------------------------------------------------------- -->

                                    <span ng-if="AverageRating > 0 && AverageRating < 1">
                                        <i class="fas fa-star-half-alt" style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(4) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>

                                    <span ng-if="AverageRating > 1 && AverageRating < 2">
                                        <i ng-repeat="n in [].constructor(1) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i class="fas fa-star-half-alt" style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(3) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>
                                    <span ng-if="AverageRating > 2 && AverageRating < 3">
                                        <i ng-repeat="n in [].constructor(2) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i class="fas fa-star-half-alt" style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(2) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>
                                    <span ng-if="AverageRating > 3 && AverageRating < 4">
                                        <i ng-repeat="n in [].constructor(3) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i class="fas fa-star-half-alt" style="color: #ffc107;"></i>
                                        <i ng-repeat="n in [].constructor(1) track by $index" class="fa-solid fa-star"
                                            style="color: #c0c0c0;"></i>
                                    </span>
                                    <span ng-if="AverageRating > 4 && AverageRating < 5">
                                        <i ng-repeat="n in [].constructor(4) track by $index" class="fa-solid fa-star"
                                            style="color: #ffc107;"></i>
                                        <i class="fas fa-star-half-alt" style="color: #ffc107;"></i>
                                    </span>
                                </span>

                                <span class="ms-1">
                                    {{AverageRating}}
                                </span>
                            </div>
                            <span class="text-muted"><i
                                    class="fas fa-shopping-basket fa-sm mx-1"></i>{{product.ratings.length}} lượt đánh
                                giá</span>
                            <span class="text-success ms-2">{{product.soldQuantity}} đã bán</span>
                        </div>

                        <div class="mb-3">
                            <span class="h5">{{getSalePrice(product.originalPrice, product.promotion) | currencyFormat}}
                            </span>
                            <span class="text-muted">/sản phẩm</span> &nbsp; <span
                                ng-show="getSalePrice(product.originalPrice, product.promotion)!==product.originalPrice"
                                style="text-decoration: line-through; color: red;">{{product.originalPrice}} VND</span>
                        </div>

                        <p>
                            {{product.description}}
                        </p>

                        <div class="row">
                            <dt class="col-3">Chất liệu</dt>
                            <dd class="col-9">{{product.material}}</dd>
                            <dt class="col-3">Ngày đăng</dt>
                            <dd class="col-9">{{getFormattedTimeAgo(product.datePost)}}</dd>
                        </div>

                        <hr />
                        <div class="row">
                            <dt class="col-3">Màu sắc</dt>
                            <dd class="col-9">
                                <div class="btn-group" data-bs-toggle="buttons">
                                    <div ng-repeat="obj in product.productColors">
                                        <label class="btn">
                                            <input type="radio" class="me-2" ng-model="selectedColor"
                                                ng-value="obj.color.colorId" name="color"
                                                ng-click="getTotal(obj.color.colorId)">
                                            {{obj.color.colorName}}
                                        </label>
                                    </div>
                                </div>
                            </dd>
                        </div>
                        <div ng-show="product.productStatus.statusId==1">
                            <div class="col-md-4 col-6 mb-3">
                                <label class="mb-2 d-block">Số lượng</label>
                                <div class="input-group mb-3" style="width: 170px;">
                                    <button ng-click="reduceQuantity()"
                                        class="btn btn-white border border-secondary px-3" type="button"
                                        id="button-addon1" data-mdb-ripple-color="dark">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" class="form-control text-center border border-secondary"
                                        ng-model="quantity" aria-label="Example text with button addon"
                                        aria-describedby="button-addon1" />
                                    <button ng-click="increaseQuantity()"
                                        class="btn btn-white border border-secondary px-3" type="button"
                                        id="button-addon2" data-mdb-ripple-color="dark">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-7 col-5 mb-8 offset-1" ng-show="total!==-1">
                                Kho: {{total}}
                            </div>

                            <a ng-click="addShoppingCart(product.productId)" class="btn btn-primary shadow-0"
                                style="background-color: white ; color: #007ACC;">
                                <i class=" fa fa-shopping-basket"></i> Thêm vào giỏ hàng </a>
                            <a ng-show="!favorite" ng-click="togglerFavorite()"
                                class="btn btn-light border border-secondary  icon-hover px-3">
                                ❤️ Yêu thích
                            </a>
                            <a ng-show="favorite" ng-click="togglerFavorite()"
                                style="border:1px solid #ff3f40 !important; color: #ff3f40;"
                                class="btn btn-light border border-secondary  icon-hover px-3">
                                <i class="fa-solid fa-heart-crack"></i> Bỏ thích
                            </a>
                        </div>
                        <h2 ng-show="product.productStatus.statusId===2" style="color: #ff3f40;">
                            NGƯNG KINH DOANH
                        </h2>
                        <h2 ng-show="product.productStatus.statusId===3" style="color: #ff3f40;">
                            ĐANG KIỂM DUYỆT
                        </h2>
                    </div>
                </main>
            </div>
        </div>
    </section>
    <!-- content -->

    <section class="bg-light border-top py-4">
        <div class="container">
            <div class="row gx-4">
                <div class="col-lg-4">
                    <div class="px-0 border rounded-2 shadow-0">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Sản phẩm liên quan</h5>
                                <div ng-repeat="obj in relatedProducts" class="d-flex mb-3">
                                    <a href="#!productdetails/{{obj.productId}}" class="me-3">
                                        <img ng-src="{{obj.media[0].mediaUrl}}" style="min-width: 96px; height: 96px;"
                                            class="img-md img-thumbnail" />
                                    </a>
                                    <div class="info">
                                        <a href="#" class="nav-link " style="padding-left: 0;">
                                            <b>{{obj.productName}}</b>
                                        </a>
                                        <small class="text-dark" ng-show="obj.promotion!=0"
                                            style="text-decoration: line-through;">
                                            {{obj.originalPrice}}</small>
                                        <span>{{getSalePrice(obj.originalPrice, obj.promotion) | currencyFormat}}</span>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 mb-4">
                    <div class="border rounded-2 px-3 py-2 bg-white  mb-5">
                        <center>
                            <h5 class="card-title"
                                style="text-align: left; font-weight: 600; display: flex; justify-content: space-between;">
                                Mô tả chi tiết
                            </h5>
                            <ul style="text-align: left; margin-left: 2rem;">
                                <li><b>Mã sản phẩm:</b> {{product.productId}}</li>
                                <li><b>Tên sản phẩm:</b> {{product.productName}}</li>
                                <li><b>Kích thước:</b> {{product.width}} x {{product.length}} x {{product.height}} |
                                    <small>(dài x rộng x cao)</small>
                                </li>
                                <li><b>Chất liệu:</b> {{product.material}}</li>
                                <li><b>Ngày đăng:</b> {{getFormattedTimeAgo(product.datePost)}}</li>
                                <li><b>Mô tả chi tiết:</b> {{product.description}}</li>

                            </ul>
                        </center>
                    </div>
                    <div class="border rounded-2 px-3 py-2 bg-white  mb-5">
                        <center>
                            <h5 class="card-title" ng-show="myRate.ratingId"
                                style="text-align: left; font-weight: 600; display: flex; justify-content: space-between;">
                                Đánh giá của tôi
                                <span><small style="font-size: 12px; color: #65676b" class="ng-binding">
                                        {{getFormattedTimeAgo(myRate.ratingDate)}}
                                    </small></span>
                            </h5>
                            <h5 ng-show="!myRate.ratingId">Bạn chưa đánh giá sản phẩm này</h5>

                            <button ng-click="removeStars($index)"
                                ng-repeat="n in [].constructor(myRatings) track by $index"
                                style="border: none; background-color: transparent;">
                                <i class="fa-solid fa-star" style="color: #ffc107;"></i></button>

                            <button ng-repeat="n in [].constructor(5-myRatings) track by $index"
                                ng-click="addStars($index)" style="border: none; background-color: transparent;"><i
                                    class="fa-solid fa-star" style="color: #c0c0c0;"></i></button>

                            <textarea class="form-control mt-2" name="" id=""
                                ng-model="myRate.ratingContent">Giá trị mặc định của textarea</textarea>
                            <a ng-click="rate()" class="btn btn-primary shadow-0 m-2"
                                style="background-color: white ; color: #007ACC;">
                                Đánh giá </a>
                        </center>
                    </div>
                    <div class="border rounded-2 px-3 py-2 bg-white">
                        <center>
                            <h5 class="card-title">Đánh giá chung ({{product.ratings.length}})</h5>
                            <li class="btn-group me-2">
                                <a style="cursor: pointer;" type="button" data-bs-toggle="dropdown"
                                    aria-expanded="false"><i class="fa-regular fa-filter-list fa-lg"></i> Lọc</a>
                                <div class="dropdown-menu dropdown-menu-animate-up">
                                    <a ng-click="changeFilterStatus('Tất cả')"
                                        class="d-flex gap-3 px-3 py-2 align-items-center dropdown-item"
                                        style="cursor: pointer;"><i class="fa-solid fa-list"></i> Tất
                                        cả</a>
                                    <a ng-click="changeFilterStatus('Tích cực')"
                                        class="d-flex gap-3 px-3 py-2 align-items-center dropdown-item"
                                        style="cursor: pointer;"><i class="fa-regular fa-face-smile-relaxed"></i> Tích
                                        cực</a>
                                    <a ng-click="changeFilterStatus('Tiêu cực')"
                                        class="d-flex gap-3 px-3 py-2 align-items-center dropdown-item"
                                        style="cursor: pointer;"><i class="fa-regular fa-face-smile-horns"></i> Tiêu
                                        cực</a>
                                </div>
                                &nbsp;&nbsp;|&nbsp;&nbsp; <span>{{filterStatus}}</span>
                            </li>

                        </center>
                        <div>
                            <div class="user-profile m-4"
                                ng-repeat="rate in product.ratings | orderBy:'-ratingDate' | filter: customFilter">
                                <div style="display: flex;" ng-show="rate.user.userId!==myRate.user.userId">
                                    <a href="#!/profile/{{rate.user.userId}}"><img ng-src="{{rate.user.avatar}}"
                                            style="border-radius: 100%;" alt=""></a>
                                    <div>

                                        <span
                                            style="font-weight: 600 !important; font-size: 1rem !important; margin: 0; color: #2A3547"
                                            class="ng-binding">{{rate.user.username}}</span> &nbsp;&nbsp; <span><small
                                                style="font-size: 12px; color: #65676b" class="ng-binding">
                                                {{getFormattedTimeAgo(rate.ratingDate)}}
                                            </small></span>
                                        <span>
                                            <i ng-repeat="n in [].constructor(rate.ratingValue) track by $index"
                                                class="fa-solid fa-star" style="color: #ffc107;"></i>
                                            <i ng-repeat="n in [].constructor(5-rate.ratingValue) track by $index"
                                                class="fa-solid fa-star" style="color: #c0c0c0;"></i>

                                        </span>
                                        <div style="margin-left: 0.3rem !important">
                                            {{rate.ratingContent}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
    <!-- Footer -->
</div>